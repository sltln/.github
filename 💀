function love.load()
    player = {
        x = 400,
        y = 300,
        speed = 600,
        angle = 0,
        bullets = {},
        fireRate = 0.1,
        fireTimer = 0,
        sensitivity = 10
    }
end

function love.update(dt)
    local moveX, moveY = 0, 0
    if love.keyboard.isDown("w") then moveY = moveY - 1 end
    if love.keyboard.isDown("s") then moveY = moveY + 1 end
    if love.keyboard.isDown("a") then moveX = moveX - 1 end
    if love.keyboard.isDown("d") then moveX = moveX + 1 end

    local length = math.sqrt(moveX * moveX + moveY * moveY)
    if length > 0 then
        moveX = moveX / length
        moveY = moveY / length
    end

    player.x = player.x + moveX * player.speed * dt
    player.y = player.y + moveY * player.speed * dt

    local mouseX, mouseY = love.mouse.getPosition()
    local targetAngle = math.atan2(mouseY - player.y, mouseX - player.x)

    local diff = targetAngle - player.angle
    if diff > math.pi then diff = diff - 2 * math.pi
    elseif diff < -math.pi then diff = diff + 2 * math.pi end

    player.angle = player.angle + diff * dt * player.sensitivity

    player.fireTimer = player.fireTimer - dt
    if love.mouse.isDown(1) and player.fireTimer <= 0 then
        fireBullet(player.x, player.y, player.angle)
        player.fireTimer = player.fireRate
    end

    for i = #player.bullets, 1, -1 do
        local b = player.bullets[i]
        b.x = b.x + math.cos(b.angle) * b.speed * dt
        b.y = b.y + math.sin(b.angle) * b.speed * dt

        if b.x < 0 or b.x > love.graphics.getWidth() or b.y < 0 or b.y > love.graphics.getHeight() then
            table.remove(player.bullets, i)
        end
    end
end

function fireBullet(x, y, angle)
    local bullet = {
        x = x,
        y = y,
        angle = angle,
        speed = 500,
        size = 10
    }
    table.insert(player.bullets, bullet)
end

function love.draw()
    -- لا يتم رسم أي شيء هنا
end
